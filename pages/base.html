<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeRyokai</title>
    <link rel="shortcut icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAFTUlEQVRYR62Xa2xURRTH/2dmn1CgFRC2jQmEANbwEAIfsBg1KkWBDwRDaoRAIUZjwsMXakTwQyMEEhHBoB94pQYKtmCgqAUrQcNTSwUrAYLbrdCisuVVS7e7995j5g673e3u9mUnuV/mnjPnd86cc2aG0MWRuZ0zvf0wk4CniDABwDAAA+6r3wEQYEY1A0dbmlB+u5Bud2Vp6kwoey+PJol3wSgAwdOZvP2fEQKhhE2sbZhLlzrSSQuQfZD7UCuKmLCEAEeXDLcTYsAgxiZ2Y2XDLLqXao2UADklPIod2E+ER3piuL0OMy6Qgdn1BXS5/b8kgOwynkiECjAG9Ybx2BqEIDPyG+bQ2fh1EwCU53DheK8bj1okBBFGXnwkYgBqz9GKn3sr7Omip7YDbkyO5kQMIGcffwzG670a9rQU2FD/Ar2hftsAqtQgUdPTbO8utKoOmBijStQGyCnj7QAWJi7EkIP/gvA1grz3NGrECatxIIxrPsBwxsTFoCDkoGCcOgPhe4ArAxzywGwcCG7KaM+5o34OFVLmfs7sa+J6fJMR/YJwTToHkdWc0jkOOxH5NRfGNdUMAWfuRThzkyosQdf8ezDCZx8Ft3j1PCPULOEjXynPE4TiqLTIugH31FMgJ8cW4Bt3gbstoJwHAE+b563FfWD2fSYRoNUAt0ZsXXI7AXdbD7PuetBaPh7sGWL/txjzKbuUtxJhkT3jMOB99geQN6Qhz/8Jc+Ve8G9XNYzHCfFSHuSKWTA3H4a1qQLm9DchlyoIHQHz0+9gbfhWyxOBJg2H3LgA5Mu0p4zNpxARC8FDR4EZ2yinjFVjUIcLHCP8cI2v0cbrgjBmrgf+1TAJQ0Wi/mZsSqxeBLlwfDLAfQlRMAVyTYH2+vsaGMtLYb68A/zQuGoFoFbKUj/deSchh9zQC72/B9auE8nGU8yIZdMhlz+XFoDyx8Hx+WINcPwyzHmfAZ4MGAu23FIAJgBhR3haJUSGTjzlPf9+7f8DCILcshhi2lgNsPNHmB+W6Sg7PVZ6gFnrwTXdB+CqWli/+G0D5HWBpowEjRyqHTFM7dil61HHbIC2LXjsFOTQf3QoV5XCKv6p2xFIqxCKwHxnN6wDVXEiZG9BWxIOD8A14bwOT/1NGDPWA3eSj3Ea5QNfjnmB+BzgW82A+lQEhgwA+rq1Q0t3wjqYcBAqierEMpQmvE9XgjLul+Gl6zBXl4LP/AFVM+jvhSh8AnJJPqztx2B+9LVqKAkA8WVIT+bCse0Vuxz5aiOM59e1qyqxLbkR9Q/C/fhJkLutEaEpBG5q0R5JO19tIOPFzeDTV9ICKDFZNNfuHXYClp6G+fau2BZY5JifuhXDD9fIIxBjfSm3VHVG84OvwBV6uzoswz4uOA6tAA0brPPw1a1RPRVmX9rDiC4eg/P8GoipI4BhDwIuCTTctjOcK2uAkG639l5PHA6aqM8Frg5AVUL8oIezQVNH66mbzbD2nVHYOwIBf2GHxzHVHIFj52uAZaSMRE8nmckQAmNqa2v1caxGugsJnTsEx5fLAEv1q94ZDLGhLuBvu5CoZTu6komq/ZC73wLY6g2CC+HwwMkNDVV2fXf5UipO74Hc+559kPd0MFHQIMqr9/tjl4duXcvFiWLIslU9sq+Mw5L5dXVX0l/LY/nQwcNEHNsKeaCouxAXIkLMjvc8VkHpVrKfZhEUMSc/zUTlFshv1nUKobKdiDaFw1kro3veXqnHj1NR8Qnk4Y3pIEKAKCHitarUOiLtFCCqnOp5LsrXDpBHv1C9/g4YAXW4WCSOCjbKA4FAl57n/wECtlnqU8xtbQAAAABJRU5ErkJggg==" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat&family=Roboto&display=swap" rel="stylesheet">

    <style>
        /*
        Follow my scheme for the css.
        And also, use proper comments to specify each section.
        */

        * {
            margin: 0;
            padding: 0;
        }

        html {
            height: 100%;
        }

        body {
            background-color: #303030;
            position: relative;
            font-family: 'Roboto', Arial, Helvetica, sans-serif;
            color: white;
            height: 100%;
        }

        /* Global */
        .button {
            background-color: #1BADFF;
            border-radius: 40px;
            padding: 5px 10px;
            font-family: 'Montserrat', sans-serif;
            font-weight: bold;
            margin: 10px;
            cursor: pointer;
            white-space: nowrap
        }

        .redButton{
            background-color: #FB1E46;
        }

        .greenButton{
            background-color: #25FFB1;
            color: #303030;
        }

        .cVR {
            height: auto;
            width: 3px;
            border-radius: 2.5px;
            background-color: #303030;
            margin: 0px 10px;
        }

        hr {
            border: 1px #303030 solid;
            margin: 5px 10px;
        }

        .sectionBG {
            background-color: #404040;
            width: 900px;
            border-radius: 15px;
            align-items: center;
            margin-bottom: 10px;
        }

        .sectionTop {
            width: 100%;
            font-family: 'Montserrat', sans-serif;
            display: flex;
            flex-direction: row;
            align-items: center;
        }

        .cH1 {
            font-size: 25px;
            font-weight: bold;
            margin: 10px;
            width: 100%;
        }

        .CInput {
            background: #303030;
            color: white;
            height: 30px;
            font-size: 25px;
            border: none;
            border-radius: 5px;
            padding: 5px;
            margin: 10px 0px;
            resize: vertical;
        }

        /* TopBar */
        #topBar {
            background-color: #404040;
            display: flex;
            align-items: center;
            height: 50px;
        }

        #logo {
            margin-left: 10px;
            min-height: 40px;
            min-width: 40px;
        }

        #topName {
            color: #25FFB1;
            font-size: 25px;
            font-family: 'Montserrat', sans-serif;
            font-weight: bold;
            width: 100%;
            margin-left: 10px;
            cursor: pointer;
        }

        #signOutProfileButton{
            display: none;
            background-color: #FB1E46;
            margin-right: 0px;
        }

        /* MainSection */
        #mainSection {
            margin: 10px 0px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /*OverPage*/
        #overPanel {
            display: none;
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
        }

        .overPanelInnerSection {
            margin: 10px;
            display: flex;
            flex-direction: column;
        }

        /* PostItem */
        .postItem {
            display: flex;
            margin: 10px;
        }
        .postItemLeft {
            height: auto;
            width: 10px;
            border-radius: 5px;
            background: #1BADFF;
            margin-right: 5px
        }
        .postItemInfo {
            color: #A0A0A0;
        }
        .postItemText {
            margin: 5px 0px;
            font-size: 20px;
        }

        @media screen and (max-width: 900px) {
                /* Global */
                .button {
                    font-size: 12px;
                    padding: 5px 8px;
                }

                .cH1 {
                    font-size: 20px;
                }

                .cVR {
                    width: auto;
                    height: 3px;
                    margin: 10px 0px;
                }

                /* topSection */
                #topBar {
                    height: 35px;
                }

                #logo {
                    min-height: 33px;
                    min-width: 33px;
                    margin-left: 0px;
                }

                #topName {
                    font-size: 18px;
                    margin-left: 5px;
                }
            

                /* body */
                .sectionBG {
                    width: 100%;
                    border-radius: 5px;
                }

                .postItemInfo {
                    font-size: 15px;
                }

                .postItemText {
                    font-size: 18px;
                }
            }
    </style>

</head>

<body>
    <script>
        function request(method, val, func){
            var req = new XMLHttpRequest();
            req.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                func(req.responseText)
                }
            };
            req.open(method, val, true);
            req.send();
        }

        function loginProfileButton(){
            if (globalVars.loggedIn == false){
                globalElems.overPanel.style.display="flex"
                globalElems.overPanel.innerHTML=`
                <div class="sectionBG">
                    <div class="sectionTop">
                        <div class="cH1">Login</div>
                        <div class="button redButton" onclick="javascript:closeOverPanel()">Close</div>
                    </div>
                    <hr>
                    <div class="overPanelInnerSection">
                        Username
                        <input type="text" class="CInput" id="overPanelUsername">
                        Password
                        <input type="password" class="CInput" id="overPanelPassword">
                        Email (Only when Signing Up)
                        <input type="text" class="CInput" id="overPanelEmail">
                    </div>
                    <div class="button" onclick="javascript:login()">Login</div>
                    <div class="button" onclick="javascript:signup()">Signup</div>
                </div>`
            }else{window.location.href = "/user/"+globalVars.username}
        }
        function login(){
            let username = document.getElementById("overPanelUsername").value;
            let password = document.getElementById("overPanelPassword").value;
            request("POST", `/api/login?username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}`, (rawRes)=>{
                if (rawRes == "success"){
                    globalVars.loggedIn=true;
                    globalVars.username=username;
                    globalVars.password=password;

                    localStorage.setItem("username", username)
                    localStorage.setItem("password", password)
                    
                    globalElems.loginProfileButton.innerText = "Profile";
                    globalElems.signOutProfileButton.style.display = "block";

                    try{postLogin();}catch(e){console.log("DEBUG: Warning post-login action not set on this page", "color: yellow;")}
                    closeOverPanel()
                }
            });
        }
        function signup(){
            let username = document.getElementById("overPanelUsername").value;
            let password = document.getElementById("overPanelPassword").value;
            let email = document.getElementById("overPanelEmail").value;
            request("POST", `/api/signup?username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}&email=${encodeURIComponent(email)}`, (rawRes)=>{
                if (rawRes == "success"){login();}
            });
        }

        function signOutProfileButton(){
            localStorage.removeItem("username");
            localStorage.removeItem("password");
            window.location.href = window.location.href;
        }

        function closeOverPanel(){
            globalElems.overPanel.style.display="none"
        }

        function openPost(postId){
            splittedPostId = postId.split("#")
            if (splittedPostId.length  == 2 && parseInt(splittedPostId[1]) != NaN){
                window.location.href = `/user/${splittedPostId[0]}/${splittedPostId[1]}`
            }
        }

        function createChatItem(postId, Rawtime, postStr, likes, comments, isCommentTo){
            let time = new Date(0);time.setUTCSeconds(Rawtime);
            let [month, date, year] = time.toLocaleDateString("en-US").split("/");
            let [hour, minute] = time.toLocaleTimeString("en-US").split(/:| /);

            let postItem = document.createElement("div");
            postItem.className = "postItem";
        
            let postItemLeft = document.createElement("div");
            postItemLeft.className = "postItemLeft";
            let postItemRight = document.createElement("div");
            postItemRight.className = "postItemRight";
            
            let postItemId = document.createElement("div");
            postItemId.className = "postItemInfo";
            postItemId.innerText = `Id: ${postId}`;
            postItemId.style.cursor = "pointer"
			postItemId.style.color = "#1badff"
            postItemId.setAttribute("onclick", `javascript:openPost("${postId}")`)
            let postItemTime = document.createElement("div");
            postItemTime.className = "postItemInfo";
            postItemTime.innerText = `Time: ${month}/${date}/${year} at ${hour}:${minute}`;
            let postItemText = document.createElement("div");
            postItemText.className = "postItemText";
            postItemText.innerText = postStr;
            let postItemLikesNComments = document.createElement("div");
            postItemLikesNComments.className = "postItemInfo";
            postItemLikesNComments.innerText = `${likes} Likes, ${comments} Comments`;
            
            if (isCommentTo != null){
                let commentTo = document.createElement("div");
                commentTo.className = "postItemInfo";
                commentTo.innerText = `Commented on: ${isCommentTo}`;
                commentTo.style.cursor = "pointer"
                commentTo.style.color = "#1badff"
                commentTo.setAttribute("onclick", `javascript:openPost("${isCommentTo}")`)
                postItemRight.append(commentTo, postItemId, postItemTime, postItemText, postItemLikesNComments);
            }
            else{
                postItemRight.append(postItemId, postItemTime, postItemText, postItemLikesNComments);
            }
            postItem.append(postItemLeft, postItemRight);
            return postItem
        }   
    
        function homeRedirect(){window.location.href = "/"}
    
    </script>

    <div id="topBar">
        <!-- <div id="logo"></div> -->
        <div id="topName" onclick="javascript:homeRedirect()">CodeRyokai</div>
        <div class="button" id="signOutProfileButton" onclick="javascript:signOutProfileButton()">Sign Out</div>
        <div class="button" id="loginProfileButton" onclick="javascript:loginProfileButton()">Login</div>
    </div>

    <div id="overPanel"></div>

    <div id="mainSection">
        {{mainSection}}
    </div>

    <script>
        var globalVars = {
            loggedIn: false,
            username: "",
            password: "",
        }
        var globalElems = {
            loginProfileButton: document.getElementById("loginProfileButton"),
            overPanel: document.getElementById("overPanel"),
            signOutProfileButton: document.getElementById("signOutProfileButton")
        }

        function retrieveData(){
            let username = localStorage.getItem("username")
            let password = localStorage.getItem("password")
            if (username != null && password != null){
                request("POST", `/api/login?username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}`, (rawRes)=>{
                    if (rawRes == "success"){
                        globalVars.loggedIn=true;
                        globalVars.username=username;
                        globalVars.password=password;
                        
                        globalElems.loginProfileButton.innerText = "Profile";
                        globalElems.signOutProfileButton.style.display = "block";
                        try{postLogin();}catch(e){console.log("DEBUG: Warning post-login action not set on this page", "color: yellow;")}
                    }
                });
            }
        }
        window.addEventListener("load", retrieveData);
    </script>
</body>
</html>